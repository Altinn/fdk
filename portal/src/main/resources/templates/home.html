<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <title>Felles datakatalog</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="webjars/bootstrap/3.1.1/css/bootstrap.min.css" media="all"/>
    <style>
.show-grid {
  margin-bottom: 15px;
}
.show-grid [class^="col-"] {
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: #eee;
  background-color: rgba(86,61,124,.15);
  border: 1px solid #ddd;
  border: 1px solid rgba(86,61,124,.2);
}
    </style>
</head>
<body>
    <div class="container-fluid">

    <header class="a-header" role="banner">
        <nav class="navbar navbar-default">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Felles datakatalog</a>
            </div>
        </nav>
    </header>

    <!-- Søkefelt -->
    <div class="form-group a-form-group">
        <div class="input-group input-group-large">

            <!-- Label -->
            <label for="search" id="searchLarge">
                <span class="sr-only"> Søk etter datasett </span>
            </label>

            <!-- Input  -->
            <input id="search" aria-labelledby="searchLarge" type="search"
                   class="form-control form-control-noleft form-control-withBtn"
                   value="" placeholder="Søk etter innhold"/>

            <div class="input-group-btn">
                <button id="dosearch" class="btn btn-secondary" type="button">
                    <i class="material-icons a-input-icon"><span class="sr-only">Utfør søk</span><span class="glyphicon glyphicon-search"></span></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Resultatfelt -->
    <section id="resultPanel">
        <p id="summary">Søkeresultat</p>
        <div class="container-fluid">
            <div class="row">

                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 sidebar">
                    <!-- fasettering -->
                    <div class="list-group">
                        <div class="list-group-item" href="#">Virksomhet<span class="badge red">2</span>
                            <ul>
                                <li><a href="#">Brønnøysundregistrene [14]</a></li>
                                <li ><a href="#">NAV [2]</a></li>
                            </ul>
                        </div>
                        <a class="list-group-item disabled" href="#">Tema<span class="badge">3</span></a>
                        <a class="list-group-item disabled" href="#">Begrep<span class="badge">5</span></a>
                        <a class="list-group-item disabled" href="#">Hjemmel<span class="badge">1</span></a>
                        <a class="list-group-item disabled" href="#">Geografi</a>
                        <a class="list-group-item disabled" href="#">Tid</a>
                        <a class="list-group-item disabled" href="#">Standard<span class="badge">2</span></a>
                    </div>
                </div>

                <!-- søkeresultat -->
                <div id="datasets" class="col-xs-8 col-xm-8 col-md-8 col-lg-8 list-group">

                    <a class="row list-group-item dataset" href="#"><strong>Enhetsregisteret</strong></a>
                    <a class="row list-group-item dataset" href="#"><strong>Oppgaveregisteret</strong></a>
                    <a class="row list-group-item dataset" href="#"><strong>Spesialregisteret</strong></a>
                    <a class="row list-group-item dataset" href="#"><strong>Hemmeligregisteret</strong></a>


                </div>
                <center>
                    <nav aria-label="Sidenavigering">
                        <ul class="pagination">
                            <li>
                                <a href="#" aria-label="Forrige">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="active"><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                            <li><a href="#">4</a></li>
                            <li><a href="#">5</a></li>
                            <li>
                                <a href="#" aria-label="Neste">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </center>
            </div>
            </div>



    </section>

    </div>
    <script src="webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="webjars/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript">
    //<![CDATA[

var searchUrl = "http://localhost:8090/search"

httpGetAsync(searchUrl, showResults);

var search = document.getElementById("search");
var dosearch = document.getElementById("dosearch");
dosearch.onclick = function (event) {
    console.log("q: " + search.value);
    doSearch();
};

search.onkeypress = function (event) {
    if (event.keyCode == 13) {
        doSearch();
    }
};

function doSearch() {
    httpGetAsync(searchUrl + "?q=" + search.value, showResults);
}

function httpGetAsync(theUrl, callback) {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous
    xmlHttp.send(null);
}

function showResults(search_result) {

    var res = JSON.parse(search_result);

    var results = document.getElementById("datasets");
    // fjerner forrige resultat
    while (results.firstChild) {
        results.removeChild(results.firstChild);
    }
    // Oppdaterer søkeinformasjon
    var total = res.hits.total;
    var summary = document.getElementById("summary");
    summary.innerHTML = "Resultat: " + total + " treff";

    // behandler hits siden
    var hits  = res.hits.hits;
    hits.forEach(function(dataset) {
        var source = dataset._source;
        var title = source.title[""];
        if (title == undefined)
            title = source.title["no"];

        var description = source.description[""];
        if (description == undefined)
           description = source.description["no"];
        var landingPage = source.landingPage;
        if (landingPage != undefined) {
            var lpElement = document.createElement("a");
            lpElement.href = landingPage;
            lpElement.target = "_blank";
            lpElement.innerHTML = "<span class=\"glyphicon glyphicon-home\"></span>";
        }

        var keywords = source.keywords[""];
        if (keywords == undefined)
            keywords = source.keywords["no"];
        if (keywords != undefined) {
            var kwElement = document.createElement("span");
            kwElement.innerHTML = " [" + keywords.join(", ") + "] ";
        }

        var row = document.createElement("a");
        row.className = "row list-group-item dataset";
        row.href = "#";
        row.innerHTML = "<strong>" + title + "</strong></br>" + description ;
        if (keywords != undefined)
            row.appendChild(kwElement);
        if (landingPage != undefined)
            row.appendChild(lpElement);

        results.appendChild(row);
    });
}
  //]]>
    </script>
</body>
</html>

